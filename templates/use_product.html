{% extends "base.html" %}
{% block title %}Log Product Usage{% endblock %}

{% block content %}
<h2 class="mb-4">üì¶ Log Product Usage</h2>

{% if success %}
<div class="alert alert-success">{{ success }}</div>
{% endif %}

<!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ USAGE LOG FORM ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<form method="POST" class="row g-3">
  <div class="col-md-3">
    <label for="staff_name" class="form-label">Staff Name:</label>
    <input type="text" class="form-control" id="staff_name" name="staff_name" required>
  </div>

  <div class="col-md-6">
    <label for="product_id" class="form-label">Product:</label>
    <select class="form-select" id="product_id" name="product_id" required>
      <option value="">-- Select Product --</option>
      {% for p in products %}
        <option value="{{ p.product_id }}">{{ p.product_name }}</option>
      {% endfor %}
    </select>
  </div>

  <div class="col-md-3">
    <label for="quantity" class="form-label">Quantity:</label>
    <input type="number" class="form-control" id="quantity" name="quantity" min="1" required>
  </div>

  <div class="col-md-3">
    <label for="purpose" class="form-label">Purpose:</label>
    <select class="form-select" id="purpose" name="purpose" required>
      <option value="Used for Service">Used for Service</option>
      <option value="Sold to Customer">Sold to Customer</option>
    </select>
  </div>

  <div class="col-12 d-flex justify-content-between mt-4">
    <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">‚Üê Back to Dashboard</a>
    <button type="submit" class="btn btn-primary">Log Usage</button>
  </div>
</form>

<!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ HQ LOG TABLES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
{% if role == 'HQ' %}
<hr class="my-5">
<h4 class="mb-3">üßæ Usage Logs</h4>

<div class="card mb-4">
  <div class="card-header"><h5 class="mb-0">üíá‚Äç‚ôÄÔ∏è Mbella Usage Log</h5></div>
  <div class="card-body p-0">
    <table class="table table-sm table-striped mb-0">
      <thead class="table-light">
        <tr><th>ID</th><th>Product</th><th>Qty</th><th>Purpose</th><th>By</th><th>Date</th></tr>
      </thead>
      <tbody>
        {% for log in mbella_usage %}
        <tr>
          <td>{{ 'U-%04d' | format(log.id) }}</td>
          <td>{{ log.staff_name }}</td>
          <td>{{ log.product_name }}</td>
          <td>{{ log.quantity }}</td>
          <td>{{ log.purpose }}</td>
          <td>{{ log.used_by }}</td>
          <td>{{ log.date_used.strftime('%d %b %Y %H:%M') }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<div class="card mb-4">
  <div class="card-header"><h5 class="mb-0">üíÖ Citibella Usage Log</h5></div>
  <div class="card-body p-0">
    <table class="table table-sm table-striped mb-0">
      <thead class="table-light">
        <tr><th>ID</th><th>Product</th><th>Qty</th><th>Purpose</th><th>By</th><th>Date</th></tr>
      </thead>
      <tbody>
        {% for log in citibella_usage %}
        <tr>
          <td>{{ 'U-%04d' | format(log.id) }}</td>
          <td>{{ log.staff_name }}</td>
          <td>{{ log.product_name }}</td>
          <td>{{ log.quantity }}</td>
          <td>{{ log.purpose }}</td>
          <td>{{ log.used_by }}</td>
          <td>{{ log.date_used.strftime('%d %b %Y %H:%M') }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% else %}
<!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ NON-HQ LOG TABLE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<hr class="my-5">
<div class="card">
  <div class="card-header"><h5 class="mb-0">üßæ {{ role }} Usage Log</h5></div>
  <div class="card-body p-0">
    <table class="table table-sm table-striped mb-0">
      <thead class="table-light">
        <tr><th>ID</th><th>Product</th><th>Qty</th><th>Purpose</th><th>By</th><th>Date</th></tr>
      </thead>
      <tbody>
        {% for log in usage_logs %}
        <tr>
          <td>{{ 'U-%04d' | format(log.id) }}</td>
          <td>{{ log.staff_name }}</td>
          <td>{{ log.product_name }}</td>
          <td>{{ log.quantity }}</td>
          <td>{{ log.purpose }}</td>
          <td>{{ log.used_by }}</td>
          <td>{{ log.date_used.strftime('%d %b %Y %H:%M') }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endif %}

<!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Select2 Dependencies ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script>
  $(document).ready(function () {
    $('#product_id').select2({
      placeholder: "-- Search Product --",
      allowClear: true,
      width: '100%'
    });
  });
</script>
{% endblock %}
